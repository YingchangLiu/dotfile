#!/bin/zsh
zmodload -Fa zsh/terminfo b:echoti p:terminfo
builtin autoload -Uz add-zle-hook-widget

.autocomplete.key.precmd() {
  if [[ -v terminfo[rmkx] ]]; then
    .autocomplete.key.normal-mode() {
      echoti rmkx
      return 0
    }
    add-zle-hook-widget line-init .autocomplete.key.normal-mode
  fi
}

if [[ ${(t)key} != association ]]; then
  unset key
  typeset -gA key=()
fi

key+=(
    Control-Space $'\0'
    Tab           $'\t'
    Return        $'\r'
    Escape        $'\e'
    Up            $'\e[A'
    Down          $'\e[B'
    Right         $'\e[C'
    Left          $'\e[D'
    End           $'\e[F'
    Home          $'\e[H'
    Shift-Tab     $'\e[Z'
    PageUp        $'\e[5~'
    PageDown      $'\e[6~'
)
